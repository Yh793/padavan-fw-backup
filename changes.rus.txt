                  Прошивка 1.1.2.2-005 для роутера Asus RT-N56U от Padavan.


Данная прошивка основана на базе:
- Официальных прошивок 1.0.x.x.
- Ядра Linux из проекта wive-rtnl, срез 3.1.3.
 (https://gitorious.org/wive-rtnl-ralink-rt305x-routers-firmware/wive-rtnl-ralink-rt305x-routers-firmware)


Список изменений относительно сборки 1.1.2.1-004:

- Переход ядра Linux на срез wive-rtnl 3.1.3:
  1) IPv6: keep permanent addresses on admin down.
  2) MIPS: Reorder operations in stackframe.h for better scheduling.
  3) netfilter: possible unaligned packet header in ip_route_me_harder.
- Обновлен драйвер ядра pppol2tp из проекта wl500g, устранена реаллокация буфера TX пакетов.
- Исправлен драйвер ядра pptp, устранена проблема совместной работы PPTP MPPE шифрования с HW_NAT, 
  увеличена скорость передачи (TX), устранена реаллокация каждого буфера TX пакетов.
- Добавлен планировщик включения/выключения гостевых WiFi точек.
- Добавлен вывод списка подключенных клиентов к VPN серверу.
- Увеличена максимальная длина логина и пароля клиентов VPN сервера до 32 символов.
- Исправлена работа с логином и паролем клиентов VPN сервера, имеющих символы пробела.
- Исправлена работа с bcrelay при подключении нескольких VPN клиентов.
- Добавлено форсированное обновление DDNS каждые 48 часов для предотвращения удаления DDNS аккаунтов
  на некоторых сервисах из-за отсутствия активности.
- Обновлен пакет udpxy до версии 1.0.23.
- Обновлен пакет minidlna до версии 1.0.25.
- Обновлен пакет vsftpd до версии 2.3.5 c новым модулем ACL extension.
- Обновлен пакет transmission до версии 2.61.
- Добавлена новая страница Wake-On-LAN со списком хостов (NewGUI).
- Добавлено всплывающее окно статуса USB накопителей (NewGUI).
- Исправлена работа функции DMZ (регрессия в 1.1.2.1).
- Исправлена работа DoS фильтра брандмауэра (ослаблен syn лимит).
- Исправлена работа DHCP клиента в режиме AP. В режиме AP по умолчанию отключен DHCP клиент.
- Исправлена работа функции Администрирование - Настройки - Восстановление настроек (NewGUI).
- Исправлен переход на летнее время для Латвии/Эстонии. Необходимо обновить таймзону в списке.
- Исправлена работа сетевых графиков для VLAN варианта прошивки (NewGUI).
- Исправлена работа кнопки Перезагрузка со страницы Main_AdmStatus_Content.asp (NewGUI).
- Исправлены недочеты на странице Advanced_WAN_Content.asp (NewGUI).
- Исправлен формат вывода таблицы маршрутизации в WebGUI.


Список изменений относительно сборки 1.1.2.1-003:

- Откат коммита "pppd: Make MSCHAP-v2 cope better with packet loss" из-за отказа работы с некоторыми ISP
  (регрессия в 1.1.2.1-002).


Список изменений относительно сборки 1.1.2.1-002:

- Активирован полный HW_NAT оффлоад для WAN PPPoE (~900 Мбит/с) для схемы подключения SoC к свитчу 2xRGMII.
- Добавлена поддержка таблицы разделов Mac в конфигурации ядра.
- Переписаны правила iptables для встроенного firewall. Исправлены ошибки, устранена дыра в FORWARD цепочке,
  исправлена проблема работы NAT loopback при включенном FastNAT path.
- Исправлен баг в драйверах WiFi при рассылке мультикаст пакетов до клиентов в PSM состоянии (напр. мобильные 
  устройства), вызывающий задержки в обслуживании (регрессия в 1.1.2.0).
- Исправлен баг xl2tpd (incoming ZLB after call closed).
- Настройка ALG вынесена в отдельную группу. ALG PPTP(+GRE) выделены из фильтра NAT passthrough.
- Добавлено поле дополнительной пользовательской AT-команды для 3G RAS-модемов.
- Добавлен вызов пользовательского скрипта /etc/storage/started_script.sh после полной загрузки роутера.
- Добавлен пользовательский файл конфигурации /etc/storage/dnsmasq.conf для dnsmasq.
- Включен TFTP сервер в сборку dnsmasq.
- Вернут полный сброс проброшенных портов через IGD miniupnpd после перезагрузки роутера.
- Рестайлинг нового Web интерфейса (NewGUI) в "ribbon_fixed". Aвтор - eagle23.
- Добавлено управление учетными записями клиентов VPN сервера в WebGUI.
- Добавлена функция Wake-On-LAN в WebGUI.
- Добавлена плавающая панель системного лога с нотификацией (NewGUI).
- Добавлены статусы WiFi активного радио и гостевых точек (NewGUI).
- Улучшена работа с графиками SystemInfo (NewGUI).
- Исправлена нерабочая настройка планировщика для WiFi 2.4ГГц (NewGUI).
- Исправлено множество замечаний в NewGUI.
- Обновлен пакет transmission до версии 2.60.
- Добавлено автоматическое создание директории /transmission на USB накопителе при старте торрент-клиента.
- Добавлен апплет inetd из busybox.
- Удалено большое количество устаревших неиспользуемых переменных в NVRAM для освобождения места.


Список изменений относительно сборки 1.1.2.0-001:

- Исправлена проблема аутентификации L2TP на новых тарифах Beeline.
- Исправлена нерабочая настройка "Мощность передатчика" для WiFi 5ГГц.


Список изменений относительно сборки 1.1.1.8f-b8:

- Переход ядра Linux на срез wive-rtnl 3.1.0:
  1) NET: fix skb_allocate and headroom size calculation in some cases.
  2) NATFastpath: Fix work with devices used headroom = 0(tun, tap, gre, etc...).
  3) BRIDGE: fix br_handle_frame processing for host pkts and allow forwarding some link local frames.
  4) TCP: reduce out_of_order memory use and speedup.
  5) SK_FILTER: make sure filters dont read uninitialized memory and speedup.
- Добавлен новый Web интерфейс "Ribbon". Отдельное спасибо автору eagle23.
- Добавлены гостевые WiFi точки 2.4 и 5ГГц.
- Добавлена функция AP-Client для WiFi модулей 2.4 и 5ГГц.
- Добавлен VPN L2TP сервер xl2tpd (без IPSec, c поддержкой драйвера ядра pppol2tp).
- Заменен L2TP клиент rp-l2tp на xl2tpd (выбор L2TP клиента доступен в конфигурации проекта).
- Устранена задержка перед поднятием PPTP/L2TP WAN соединения.
- Добавлена функция включения ограничителя CPU для защиты PPP сессии от разрыва при 100% загрузке CPU 
  во время передачи данных на высокой скорости (PPPoE без HW_NAT, либо PPTP/L2TP).
- Исправлена проблема RDP подключений через VPN PPTP сервер со включенным шифрованием MPPE.
- Изменено правило формирования версии прошивки. Версия прошивки имеет сквозную нумерацию билда и более 
  не привязана к версиям официальных прошивок.


Список изменений относительно сборки 1.1.1.8f-b7:

- Переход ядра Linux на срез wive-rtnl 3.0.5:
  1) Исправлен баг в raeth, приводящий к спонтанным перезагрузкам роутера при попадании в LAN или WAN порт 
  Ethernet пакетов больше 1514 байт.
  2) Фиксы HW_NAT для оффлоада WiFi.
- Исправлен баг выхода за диапазон в WiFi драйвере rt2860v2_ap (5ГГц). Отключено использование 16 слотов под
  MAC маяки (beacons), использующие доп. ресурсы CPU на переключения контекста sharemem.
- Исправлен баг отображения страницы WDS 2.4ГГц в Firefox.
- Исправлен баг обновления Web страниц после применения изменений.
- Отключено принудительное добавление IP адреса шлюза в resolv.conf в режиме AP.
- Изменена логика включения/выключения WiFi точек. Грубое включение/отключение трансивера находу
  больше не используется. При отключении точки полностью закрывается сетевой интерфейс (ra0/rai0) 
  и удаляется из бриджа br0. При включении точки выполняется запуск сетевого интерфейса и полная 
  инициализация. Такая же логика при управлении точки с планировщика и с переназначенной кнопки WPS.
- Параметр ядра rp_filter (reverse-path filter) вынесен в стартовый скрипт и не перезаписывается из rc.
- Обновлен dnsmasq до версии 2.62.
- Увеличена задержка после сброса USB хост-контроллера для более стабильного определения USB устройств 
  при загрузке роутера.


Список изменений относительно сборки 1.1.1.8f-b6:

- Переход ядра Linux на срез wive-rtnl 3.0.3:
  1) Исправлена регрессия сборки IP фрагментов (баг 2.5.0).
  2) Обновлена кодовая база Ralink SDK 4.0.1.0, обновлен Ethernet драйвер raeth, драйвер hw_nat.
  3) Включена полная фильтрация mcast/bcast RX трафика из PPE.
  4) Бэкпорты usbnet/cdc_ether/rndis_host из апстрима (для работы Android/WM устройств через RNDIS).
  5) Бэкпорты IPv6 из апстрима.
  6) Исправлена регрессия регистрации sysfs для модулей ядра.
  7) Исправлена регрессия установки fs.file-max.
  8) Исправлена работа функции OOM Delay.
- Обновлен WiFi драйвер rt2860v2_ap (5ГГц) до версии 2.4.3.6.
- Добавлена защита разделяемых ресурсов hw_nat rx/tx в драйвере rt3090_ap при включении WiFi HW_NAT offload.
- В конфигурации ядра отключены функции WSC/WPS, ATE, IAPP у обоих WiFi драйверов.
- Полностью удалены функции WSC/WPS из userlevel окружения и WebGUI.
- Добавлена настройка выбора верхнего/нижнего расширенного WiFi канала (40МГц) в режиме автоматического 
  выбора основного канала для точки 2.4ГГц.
- Доработана логика управления сетевыми интерфейсами WiFi при смене настроек WiFi а также включении/отключении
  WiFi трансивера как с WebGUI, так и через переназначенную физическую кнопку WPS.
- Исправлено сканирование AP на странице WDS точки 2.4ГГц. Исправлено некорректное заполнение списка
  отсканированных AP. Отключено принудительное сканирование при переходе на страницу WDS обоих WiFi точек.
- Добавлен автоматический вызов скрипта /opt/bin/on_hotplug_printer.sh после подключения принтера.
  Скрипт предназначен для загрузки микрокода в некоторые модели принтеров для работы с портами LPR и RAW.
- Добавлен поддержка ZeroConf для pure PPPoE. Требуется для работы IPTV некоторых ISP (например Ростелеком).
- Добавлена поддержка 3G/4G модемов (в т.ч. Yota LTE) с интерфейсом RNDIS.
- Удалена поддержка устаревших модемов WiMAX.
- Удалена установка скорости управляющего порта для UMTS/CDMA модемов (RAS).
- Добавлена настраиваемая функция автоматического перезапуска WAN при подключении USB
  модема. Добавлен автоматический перезапуск WAN при безопасном отключении USB модема.
- Добавлена ротация файла системного лога при превышении размера 500КБ для предотвращения
  переполнения /tmp и экономии ОЗУ.
- Добавлена userlevel утилита hw_nat от Ralink.
- Добавлено сохранение проброшенных портов через IGD UPnP/NAT-PMP после перезагрузки роутера.
- Обновлен IGD сервер miniupnpd до версии 1.7.
- Обновлен торрент transmission до версии 2.52.
- Доработан драйвер свитча rtl8367, добавлена поддержка свитча RTL8367R-VB, а также возможная работа 
  с одним RGMII и VLAN1/2. Обновлена утилита rtl8367m, добавлен вывод mib счетчиков для всех портов 
  свитча, добавлен скрипт rtl8367mib.
- Доработано конфигурирование изоляции WAN моста и фильтрации теггированного VLAN трафика ISP.
- Исправлен нерабочий статический LAN IP адрес в режиме работы AP (точка доступа).
- Исправлен переход на некоторых страницах WebGUI при динамическом LAN IP адресе в режиме работы AP.
- Исправлено искажение многих управляющих элементов WebGUI в браузере Chrome и FireFox.
- Отключены отладочные сообщения miniupnpd в системный лог.
- Сделано закрытие всех сетевых соединений перед перезагрузкой роутера после перепрошивки через WebGUI.


Список изменений относительно сборки 1.1.1.8f-b5:

- Переход ядра Linux на срез wive-rtnl 2.5.1:
  1) Исправлена аллокация памяти для embedded устройств (регрессия фрагментации ОЗУ).
  2) Исправлен SLUB аллокатор.
  3) Улучшена совместимость реализации TCP протокола с требованиями RFC.
  4) Улучшена поддержка IPv6.
  5) Исправлено сканирование SCSI устройств для USB storage (проблема определения некоторых накопителей).
  6) Исправлена регрессия регистрации монолитных модулей в sysfs.
- Добавлена задержка 3с перед запуском серверов печати после подключения принтера в USB порт.
- Исправлена загрузка пользовательских статических маршрутов типа LAN.
- Исправлена работа логики WAN down для соединения static IP.
- Добавлена утилита hw_nat от Ralink для контроля состояния HW_NAT.


Список изменений относительно сборки 1.1.1.8e-b4:

- Перенесены изменения из официальной прошивки 1.0.1.8f.
- Исправлен биндинг торрента Transmission на все интерфейсы. Transmission работает на WAN 
  интерфейсах и более не находится за NAT. Не требует проброса портов.
- Исправлена ошибка сборки USB-over-Ethernet сервера печати u2ec под gcc-4xx, печать из
  Windows с использованием vuhub драйвера Asus теперь работает.
- Добавлена поддержка печати через TCP/IP RAW порт 9100 посредством сервера p910nd.
- Добавлена страница в WebGUI для управления серверами печати.
- Изменена логика загрузка серверов печати - запуск серверов выполняется только после подключения 
  принтера к USB и выгрузка после отключения принтера из USB.
- Увеличено время таймаута DHCP клиента до 16 секунд для улучшения работы с загруженными DHCP 
  серверами провайдера.
- Доработана логика выбора узла ttyUSBx для USB 3G модемов. Добавлена возможность ручного 
  выбора узла ttyUSBx в WebGUI, в случае если автовыбор работает некорректно с отдельными 
  моделями USB модемов.
- Исправлена проблема отображения в WebGUI накопителей, содержащих в имени символы ',",`.
- Исправлено определение USB HDD накопителей с USB дескриптором bNumInterfaces > 1.
- Обновлен пакет dnsmasq-2.61.
- Обновлен пакет miniupnpd-1.6.20120502.
- Добавлена отсутствующая QoS утилита tc из пакета iproute2.
- Добавлена возможность задавать интервал бездействия (spindown таймер), а также отключать 
  APM (автопарковка головок) для USB HDD. Некоторые модели USB HDD не поддерживают APM и/или 
  spindown таймер.


Список изменений относительно сборки 1.1.1.8e-b3:

- Переход ядра Linux на срез wive-rtnl 2.5.x: 
  1) HW_NAT - исправления порчи mcast/bcast пакетов при PPE WiFi offload.
  2) Netfilter - фикс icmp conntrack.
  3) Slab - фикс возможной утечки памяти.
- Исправлена регрессия локального резольвинга из /etc/hosts в uClibc-0.9.28.3.
- Исправлено отключение NAT (пропадание Интернет в LAN) при включении функций 
  "BattleNET" и "Переключатель портов".
- Исправлен kernel oops при выгрузке модуля ipt_autofw.ko ("Переключатель портов").
- Включены CONFIG_PM и CONFIG_SCSI_SCAN_ASYNC в конфигурации ядра.
- Удалена вся рудиментарная логика из rc, проинспектировано масса грязного кода в rc, 
  исправлены сотни хинтов gcc при сборке rc. ASUS Download Master более не поддерживается.
- Доработана логика запуска USB приложений при старте роутера а также при USB hotplug. 
- Добавлен торрент клиент Transmission 2.51. Для работы торрента достаточно создать на 
  требуемом разделе USB накопителя директорию "transmission". Порты UDP и TCP для входящих 
  соединений пиров пробрасываются автоматически при запуске/останове торрент клиента. 
  Добавлено включение доступа к интерфейсу управления из WAN.
- Добавлено управление tcp_syncookies (prevent SYN flood attack) из WebGUI. По умолчанию
  tcp_syncookies выключена.
- Доработана общая логика сборки проекта, поддерживается выбор всех параметров 
  в файле .config.


Список изменений относительно сборки 1.1.1.8e-b2:

- Переход ядра Linux на срез wive-rtnl 2.4.1: 
  1) VFS - исправление регрессии sendfile, решение проблем с minidlna и samba сервером.
  2) FastNat - оптимизация, фиксы. 
  3) HW_NAT - исключение mcast/bcast трафика из PPE, фикс для GRE пакетов.
  4) Netfilter - оптимизация, фиксы.
- Откат на стабильный uClibc-0.9.28.3.
- Исправлена регрессия с URL Filter и LAN to WAN Filter.
- Исправлена регрессия printk в системном логе (пропадание строк).
- Добавлена подгрузка пользовательских маппингов из /etc/storage/hosts.
- Добавлена очистка conntrack table и route table после события wan down.
- Исправлена работа Logout/Reboot со страницы Statistics.
- NAT loopback включен по умолчанию.


Список изменений относительно сборки 1.0.1.8e-p2:

- Проект переведен в новое дерево с переработанной структурой сборки пакетов.
- Переход на новый кросс-компилятор gcc-4.4.7, binutils-2.21.1, uClibc-0.9.33.
- Полная замена стокового ядра Linux на ядро Linux из проекта wive-rtnl, содержащее огромное кол-во 
  бекпортов из апстрима и множество оптимизаций, в том числе для SoC Ralink.
- Добавлен openssl-0.9.8u.
- Добавлен libiconv-1.13.1.
- Добавлен sftp-server из пакета openssh-5.9p1.
- Обновлен пакет dnsmasq-2.60. 
- Обновлен пакет iptables-1.3.8. 
- Заменен драйвер ufsd с поддержкой как NTFS, так и HFS/HFS+.
- Правила NAT MASQUERADE заменены на более быстрый SNAT.
- NAT loopback отключен по умолчанию и управляется из Web интерфейса.
- Добавлен выбор модели NAT - RCONE/FCONE/Linux. По умолчанию строгая модель RCONE.
- Наложен security патч CVE-2012-1182.patch для samba-3.0.37.
- Исправлены некоторые недочеты в Web интерфейсе.


ВНИМАНИЕ!
На данной прошивке НЕ РАБОТАЕТ:
- WPS/WSC. Полностью отключено из-за большой дыры в безопасности WiFi.
- ASUS Download Master более не поддерживается. Заменен на Transmission.





-
26.07.2012
Padavan
